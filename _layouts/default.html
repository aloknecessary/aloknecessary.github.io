<!doctype html>
<html lang="en" data-theme="light">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    {% if page.layout == "architect" %}
      <title>{{ page.title }}</title>
    {% else %}
      <title>{{ page.title }} | {{ site.title }}</title>
    {% endif %}
    
    {% include head.html %}
    {% seo %}

    {% if jekyll.environment == 'production' and site.google_analytics %}
      {% include google-analytics.html %}
    {% endif %}

    <script>
      (function () {
        const THEME_KEY = "theme";
        const root = document.documentElement;
        const mediaQuery = window.matchMedia("(prefers-color-scheme: dark)");

        function getSystemTheme() {
          return mediaQuery.matches ? "dark" : "light";
        }

        function applyTheme(theme) {
          root.setAttribute("data-theme", theme);
        }

        function getStoredTheme() {
          return localStorage.getItem(THEME_KEY) || "system";
        }

        function initTheme() {
          const stored = getStoredTheme();

          if (stored === "system") {
            applyTheme(getSystemTheme());
          } else {
            applyTheme(stored);
          }
        }

        function setTheme(theme) {
          localStorage.setItem(THEME_KEY, theme);

          if (theme === "system") {
            applyTheme(getSystemTheme());
          } else {
            applyTheme(theme);
          }
        }

        function handleSystemChange(e) {
          if (getStoredTheme() === "system") {
            applyTheme(e.matches ? "dark" : "light");
          }
        }

        function initDropdown() {
          const select = document.getElementById("theme-select");
          if (!select) return;

          const stored = getStoredTheme();
          select.value = stored;

          select.addEventListener("change", (e) => {
            setTheme(e.target.value);
          });
        }

        // Initialize immediately
        initTheme();

        // Listen for OS changes
        mediaQuery.addEventListener("change", handleSystemChange);

        // Initialize dropdown after DOM ready
        document.addEventListener("DOMContentLoaded", initDropdown);

        // Optional: expose setter
        window.setTheme = setTheme;
      })();

      // for the segmented buttons
      function initSegmentedControl() {
        const buttons = document.querySelectorAll("[data-theme-option]");
        if (!buttons.length) return;

        const current = localStorage.getItem("theme") || "system";

        buttons.forEach(btn => {
          if (btn.dataset.themeOption === current) {
            btn.classList.add("active");
          }

          btn.addEventListener("click", () => {
            const selected = btn.dataset.themeOption;

            setTheme(selected);

            buttons.forEach(b => b.classList.remove("active"));
            btn.classList.add("active");
          });
        });
      }
      document.addEventListener("DOMContentLoaded", initSegmentedControl);

    </script>

    <link rel="stylesheet" href="{{ '/assets/css/main.css' | relative_url }}" />

  </head>
  <body>
    <!-- <header>
      <h1>{{ site.title }}</h1>
      <nav class="hidden">
         Add navigation links here if needed 
      </nav>
    </header> -->

    {% unless page.hide_header %}

    <header>
      <h1>Alok Ranjan Daftuar</h1>
      <p>
        Solution Architect specializing in cloud-native systems, scalable
        architectures, and pragmatic engineering decisions that align technology
        with business outcomes.
      </p>
      <div class="theme-controls">
        <div class="theme-segmented" role="group" aria-label="Theme selection">
          <button type="button" data-theme-option="system">System</button>
          <button type="button" data-theme-option="light">Light</button>
          <button type="button" data-theme-option="dark">Dark</button>
        </div>
      </div>

    </header>

    {% endunless %}

    <main>{{ content }}</main>

    <!-- Cookie Notice (only loads in production) -->
    {% if jekyll.environment == 'production' and site.google_analytics %}
      {% include cookie-notice.html %}
    {% endif %}
    
    <footer>{% include footer.html %}</footer>
  </body>
</html>
